---
inclusion: always
description: "MCPサーバーのアーキテクチャ設計原則とベストプラクティス"
---

# アーキテクチャ設計原則

## モジュール設計

### 単一責任の原則
- 各モジュールは明確に定義された単一の責任を持つ
- `topicAnalyzer`: トピック分析専用
- `categoryGenerator`: カテゴリー生成専用
- `optionGenerator`: 選択肢生成専用

### 依存関係の管理
```
src/
├── index.ts              # MCPサーバーエントリーポイント
├── config/
│   └── environment.ts    # 環境変数管理
├── utils/                # 共通ユーティリティ
│   ├── logger.ts
│   ├── gemini.ts
│   ├── rateLimiter.ts
│   └── jsonCorrector.ts
├── modules/              # 機能モジュール
└── tools/                # MCPツール実装
```

## プロンプト設計原則

### テンプレート化
- プロンプトは再利用可能なテンプレートとして設計
- 変数置換による動的生成
- 統一された変数命名（`{{TARGET_*}}`形式）

### 柔軟性の確保
- カテゴリの性質に応じた自然な選択肢数調整
- プロンプト要素としての自然な表現重視
- 多様性確保のための具体的指示

## データフロー設計

### 段階的処理
1. 入力バリデーション
2. コンテキスト構築
3. カテゴリー生成
4. 選択肢生成（並列処理可能）
5. 結果統合・返却

### エラー伝播
- 各段階でのエラーハンドリング
- 上位レイヤーへの適切なエラー伝播
- ユーザーフレンドリーなエラーメッセージ

## 拡張性の考慮

### 機能拡張ポイント
- 新しい生成モードの追加
- 異なるAIプロバイダーの対応
- 追加のプロンプトテンプレート

### 設定の外部化
- 環境変数による設定管理
- デフォルト値の適切な設定
- 開発・本番環境の切り分け